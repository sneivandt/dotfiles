name: Tests

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  shellcheck:
    name: ShellCheck
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Run ShellCheck
        uses: ludeeus/action-shellcheck@master
        with:
          scandir: '.'
          ignore_paths: 'env'
          
  test:
    name: Run Tests
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, ubuntu-20.04]
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive
      
      - name: Run dotfiles tests
        run: ./dotfiles.sh --test -v
      
      - name: Test installation (dry-run)
        run: ./dotfiles.sh --install -v || true
