#!/usr/bin/env bash
# Performance profiling helper for bash startup
# To profile bash startup, use the bash-profile function
#   Example: bash-profile

# Convenient function to profile shell startup
bash-profile() {
  local logfile
  # Use mktemp to create secure temporary file
  logfile=$(mktemp "${TMPDIR:-/tmp}/bash-profile.XXXXXX.log")
  # Use double quotes for PS4 so timestamp is evaluated in child shell context
  bash -x -i -c 'PS4="+ $(date +%s.%N) "; set -x; exit' 2>"$logfile"
  echo "Profile log saved to: $logfile"
  echo "Showing last 30 lines (most recent operations):"
  grep -E "^\+" "$logfile" | tail -30
  echo ""
  echo "To view full log: less $logfile"
  echo "To delete log: rm $logfile"
}

# Measure startup time (portable - works with bash built-in time)
alias bash-startup-time='for i in {1..10}; do time bash -ic "exit" 2>&1 | grep real; done'
