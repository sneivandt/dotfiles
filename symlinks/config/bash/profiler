#!/usr/bin/env bash
# Performance profiling helper for bash startup
# To profile bash startup, set BASH_PROFILE_STARTUP=1 before running bash
#   Example: BASH_PROFILE_STARTUP=1 bash -ic exit

# Enable xtrace if profiling is requested
if [[ -n "$BASH_PROFILE_STARTUP" ]]; then
  PS4='+ $(date "+%s.%N")\011 '
  exec 3>&2 2>/tmp/bash-profile-$$.log
  set -x
fi

# Convenient function to profile shell startup
bash-profile() {
  local logfile
  logfile=$(mktemp /tmp/bash-profile-XXXXXX.log)
  PS4='+ $(date "+%s.%N") ' bash -x -i -c "exit" 2>"$logfile"
  echo "Profile log: $logfile"
  grep -E "^\+" "$logfile" | tail -30
  rm -f "$logfile"
}

alias bash-startup-time='for i in {1..10}; do /usr/bin/time -f "%E elapsed" bash -ic exit 2>&1 | grep elapsed; done'
