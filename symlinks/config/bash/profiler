#!/usr/bin/env bash
# Performance profiling helper for bash startup
# To profile bash startup, set BASH_PROFILE_STARTUP=1 before running bash
#   Example: BASH_PROFILE_STARTUP=1 bash -ic exit

# Enable xtrace if profiling is requested
if [[ -n "$BASH_PROFILE_STARTUP" ]]; then
  PS4='+ $(date "+%s.%N")\011 '
  exec 3>&2 2>/tmp/bash-profile-$$.log
  set -x
fi

# Convenient alias to profile shell startup
alias bash-profile='BASH_PROFILE_STARTUP=1 bash -ic exit 2>&1 | grep -E "^\+" | tail -20'
alias bash-startup-time='for i in {1..10}; do /usr/bin/time -f "%E elapsed" bash -ic exit 2>&1 | grep elapsed; done'
