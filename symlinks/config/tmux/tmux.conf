# Preamble ---------------------------------------------------------------- {{{

set -g default-terminal "tmux-256color"
set -g default-command "${SHELL}"
set -g base-index 1
set -g renumber-windows on
set -g history-limit 50000
set -g display-time 4000
set -g status-interval 5
setw -g automatic-rename on
set -sg escape-time 0
set -g focus-events on
set-option -sa terminal-overrides ',xterm-256color:RGB'

# }}}
# Bindings ---------------------------------------------------------------- {{{

bind n new-window
bind C-b next-window
bind s split-window -v -c '#{pane_current_path}'
bind v split-window -h -c '#{pane_current_path}'
bind r resize-pane -y 12

bind -n M-C-j resize-pane -D
bind -n M-C-k resize-pane -U
bind -n M-C-h resize-pane -L
bind -n M-C-l resize-pane -R

# }}}
# Mouse ------------------------------------------------------------------- {{{

set -g mouse on

bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M

# }}}
# Copy Mode --------------------------------------------------------------- {{{

bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "xclip -selection clipboard -in"
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "xclip -selection clipboard -in"

# }}}
# Clipboard
set -s set-clipboard on

# Theme ------------------------------------------------------------------- {{{
# TokyoNight Night color scheme matching nvim theme exactly
# Uses true color (24-bit RGB) for precise color matching
# Color palette from tokyonight.nvim:
#   - #1a1b26: Background (main)
#   - #16161e: Background (darker)
#   - #24283b: Background (selection/highlight)
#   - #414868: Border/separator grey
#   - #565f89: Comment grey (inactive text)
#   - #7aa2f7: Blue (primary accent)
#   - #7dcfff: Cyan
#   - #c0caf5: Foreground (main text)

set  -g status "on"
set  -g status-style "bg=#1a1b26,fg=#c0caf5"
set  -g status-justify "left"
set  -g status-left-length "100"
set  -g status-right-length "100"

# Left: session name with blue background (matches lualine mode section)
set  -g status-left "#[fg=#1a1b26,bg=#7aa2f7,bold] #S #[fg=#7aa2f7,bg=#1a1b26,nobold,nounderscore,noitalics]"

# Right: date/time and hostname (matches lualine right sections)
# Note: Intentional double-space between date and time for better visual separation
set  -g status-right "#[fg=#24283b,bg=#1a1b26,nobold,nounderscore,noitalics]#[fg=#c0caf5,bg=#24283b] %Y-%m-%d  %H:%M #[fg=#7aa2f7,bg=#24283b,nobold,nounderscore,noitalics]#[fg=#1a1b26,bg=#7aa2f7,bold] #h "

# Pane borders (blue for active, dark grey for inactive)
set  -g pane-active-border-style "fg=#7aa2f7"
set  -g pane-border-style "fg=#414868"

# Window status (matches lualine tabline)
setw -g window-status-separator ""
setw -g window-status-format "#[fg=#565f89,bg=#1a1b26] #I #[fg=#565f89,bg=#1a1b26]#W "
setw -g window-status-current-format "#[fg=#1a1b26,bg=#24283b,nobold,nounderscore,noitalics]#[fg=#7aa2f7,bg=#24283b] #I #[fg=#c0caf5,bg=#24283b,bold]#W #[fg=#24283b,bg=#1a1b26,nobold,nounderscore,noitalics]"

# Message styling (blue background for commands, dark for normal messages)
set  -g message-style "fg=#c0caf5,bg=#7aa2f7"
set  -g message-command-style "fg=#c0caf5,bg=#24283b"

# Window activity/bell styling
setw -g window-status-activity-style "fg=#7aa2f7,bg=#1a1b26"
setw -g window-status-bell-style "fg=#f7768e,bg=#1a1b26"

# Pane number display (when you type prefix + q)
set  -g display-panes-active-colour "#7aa2f7"
set  -g display-panes-colour "#565f89"

# Clock mode (prefix + t)
setw -g clock-mode-colour "#7aa2f7"

# }}}
# Vim Tmux Navigator ------------------------------------------------------ {{{

is_vim='echo "#{pane_current_command}" | grep -iqE "(^|\/)g?(view|n?vi(m|mx)?)(diff)?$"'
bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"

# }}}
