#!/bin/sh

# Source system-wide xinitrc.d scripts
if [ -d "/etc/X11/xinit/xinitrc.d" ]
then
  for f in /etc/X11/xinit/xinitrc.d/*
  do
    [ -x "$f" ] && . "$f"
  done
  unset f
fi

# Load X resources
[ -f "$HOME/.Xresources" ] && xrdb "$HOME/.Xresources"

# Disable screen blanking and power management
xset s off
xset -dpms
xset s noblank

# Initialize systemd user session for X
# This allows user systemd units to access X environment variables
if [ -f /etc/X11/xinit/xinitrc.d/50-systemd-user.sh ] && [ -n "$(command -vp systemctl)" ]
then
  /etc/X11/xinit/xinitrc.d/50-systemd-user.sh
  systemctl --user import-environment PATH DBUS_SESSION_BUS_ADDRESS DISPLAY XAUTHORITY
  systemctl --no-block --user start xsession.target
fi

# Start window manager
if [ -n "$(command -vp xmonad)" ]
then
  exec xmonad
else
  echo "Error: xmonad not found, cannot start window manager" >&2
  exit 1
fi
